---
title: "MaiaAnalysis"
author: "Malayka Mottarella"
date: "2024-02-15"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
    number_sections: true
    theme: cosmo
  pdf_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

rm(list=ls())

# Packages:
library(tidyverse)  # Data manipulation and visualization
library(dplyr)      # Tabular data manipulation
library(tidyr)      # Data manipulation
library(naniar)     # Handles missing values
library(readxl)     # Import Microsoft Excel files
library(writexl)
library(ggplot2)    # Data visualization
library(ggthemes)   # Additional ggplot2 themes and scales
#library(ggExtra)    # Additional ggplot2 functions, enhances ggplot2 graphs
library(ggpubr)     # Additional ggplot2 functions, creates publication-ready plots
library(kableExtra) # Additional kable table functions
library(purrr)      # Loops and iterations of functions
library(effsize)    # Cohen's D calculation
library(Hmisc)      #rcorr function
library(car)        #Levenes test
library(reshape2)   # melt function

# Set up correlation matrix function
flattenCorrMatrix <- function(cormat, pmat) {
  ut <- upper.tri(cormat)
  data.frame(
    row = rownames(cormat)[row(cormat)[ut]],
    column = rownames(cormat)[col(cormat)[ut]],
    cor  =(cormat)[ut],
    p = pmat[ut]
    )
}


# Set up correlation function
GenCorr <- function(df){
  df.cor <- rcorr(as.matrix(df), type = "pearson")
  df.cormat <- flattenCorrMatrix(round(df.cor$r, 3), round(df.cor$P, 3))
  df.cormat$p_fdr <- p.adjust(df.cormat$p, method = "fdr", n = length(df.cormat$p))
  # Make table with fdr corrected p-values highlighted
kable(df.cormat) %>%#
  kable_styling(bootstrap_options = c("hover", "striped")) %>%
  row_spec(which(df.cormat$p <0.1), bold = T, color = "black", background = "pink")%>%
  row_spec(which(df.cormat$p <0.05), bold = T, color = "black", background = "#ffffcc")%>%
  row_spec(which(df.cormat$p <0.01), bold = T, color = "black", background = "#c2e699")
}

# Function to group rows in kbl tables.
collapse_rows_df <- function(df, variable){
  group_var <- enquo(variable)
    
  df %>% 
      group_by(!! group_var) %>%
      mutate(groupRow = 1:n()) %>%
      ungroup() %>%
      mutate(!!quo_name(group_var):= ifelse(groupRow == 1, as.character(!! group_var), "")) %>%
      select(-c(groupRow))
}



```


```{r load_data}

# Load in .csv

data <- read.csv("MaiaData_CardSort.csv")

```

## Descriptives of Dataset

```{r cars}
descriptive = psych::describe(data)

```   
## Bias score 
```{r bias_histo}

data %>%
  ggplot(aes(x=BiasScore)) +
  geom_histogram(fill = "grey", color = "black") +
  ggtitle("Distribution of Bias Scores")

data %>%
  ggplot(aes(x=BiasScore)) +
  geom_density(fill = "grey", color = "black") +
  ggtitle("Distribution of Bias Scores")


# Split groups based on bias score
biased <- subset(data, data$BiasScore > 0.5 | data$BiasScore < -0.5)
neutral <- subset(data, data$BiasScore <= 0.5 & data$BiasScore >= -0.5)

biased$Group = "biased"
neutral$Group = "neutral"

data_grouped <- rbind(biased, neutral)

data_grouped %>%
  ggplot(aes(x = BiasScore, fill = Group))+
  geom_histogram()


data_grouped %>%
  ggplot(aes(x = Incon.ConRT, fill = Group, color = Group))+
  geom_histogram()



```

## Bar plot of reaction times by trial type and attention
```{r}
# Load necessary libraries
library(tidyverse)
library(ggplot2)
library(reshape2) 

data$Attention <- ifelse(data$BiasScore > 0.5 | data$BiasScore < -0.5, "Biased", "Neutral")
data$IPS <- ifelse(data$BiasScore > 0, "Verbal", "Visual")

#Reaction times
#Biased attender histograms and descriptive statistics
biased_data<- data[data$Attention == "Biased", ]
neutral_data<- data[data$Attention == "Neutral", ]

# Combine biased and neutral data
data$Attention <- ifelse(data$BiasScore > 0.5 | data$BiasScore < -0.5, "Biased", "Neutral")
biased_data<- data[data$Attention == "Biased", ]
combined_data <- rbind(biased_data, neutral_data)

# Calculate means by attention and trial type
means <- combined_data %>%
  group_by(Attention) %>%
  summarise(Con_RT = mean(Con_RT), InCon_RT = mean(InCon_RT)) %>%
  pivot_longer(cols = c(Con_RT, InCon_RT), names_to = "Trial_Type", values_to = "Mean_RT")

# Order factor levels for better plotting
means$Attention <- factor(means$Attention, levels = unique(means$Attention))

# Create bar plot
        
ggplot(means, aes(x = Attention, y = Mean_RT, fill = Trial_Type)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Mean Reaction Times by Attention and Trial Type",
       x = "Condition",
       y = "Mean Reaction Time (ms)") 
```

#figure out how to put error bars

## Incongruency Effect Descriptives
```{r}

# Incongruency Effect Calculation
data$IncongruencyEffect <- data$InCon_RT - data$Con_RT
Incongruency_Effect_Data <- data$IncongruencyEffect

biased_data$Incongruency_Effect_Data <- biased_data$InCon_RT - biased_data$Con_RT
neutral_data$Incongruency_Effect_Data <- neutral_data$InCon_RT - neutral_data$Con_RT

psych::describe(biased_data$Incongruency_Effect_Data)
psych::describe(neutral_data$Incongruency_Effect_Data)

#Figure out how to change the variable from X1 to biased and neutral

# Biased Attender Incongruency Effect Descriptive Statistics
biased_IE_mean <- mean(biased_data$Incongruency_Effect_Data)
biased_IE_std <- sd(biased_data$Incongruency_Effect_Data)
biased_IE_min <- min(biased_data$Incongruency_Effect_Data)
biased_IE_max <- max(biased_data$Incongruency_Effect_Data)

# Data frame for Biased Attender Incongruency Effect Descriptive Statistics
biased_descriptive_IE <- data.frame(
  Attention = "Biased",  
  Variable = "Incongruency Effect",
  Mean = biased_IE_mean,
  StdDev = biased_IE_std,
  Min = biased_IE_min,
  Max = biased_IE_max,
  stringsAsFactors = FALSE
)

# Neutral Attender Incongruency Effect Descriptive Statistics
neutral_IE_mean <- mean(neutral_data$Incongruency_Effect_Data)
neutral_IE_std <- sd(neutral_data$Incongruency_Effect_Data)
neutral_IE_min <- min(neutral_data$Incongruency_Effect_Data)
neutral_IE_max <- max(neutral_data$Incongruency_Effect_Data)

# Data frame for Neutral Attender Incongruency Effect Descriptive Statistics
neutral_descriptive_IE <- data.frame(
  Attention = "Neutral",  
  Variable = "Incongruency Effect",
  Mean = neutral_IE_mean,
  StdDev = neutral_IE_std,
  Min = neutral_IE_min,
  Max = neutral_IE_max,
  stringsAsFactors = FALSE
)

descriptive_statistics_IE <- rbind(biased_descriptive_IE, neutral_descriptive_IE)
print(descriptive_statistics_IE)
```
## Incongruency Effect Box Plot
```{r}
# Load necessary libraries
library(ggplot2)

# Combine biased and neutral data for the box plot
combined_data <- rbind(biased_data, neutral_data)

# Create box plot
ggplot(combined_data, aes(x = Attention, y = Incongruency_Effect_Data, fill = Attention)) +
  geom_boxplot() +
  labs(
    title = "Incongruency Effect Box Plot",
    x = "Attention",
    y = "Incongruency Effect (ms)"
  ) 
```
## Incongruency Effect Scatter Plot

```{r}
# Scatter Plot of Incongruency Effect
plot(neutral_data$Incongruency_Effect_Data, 
     col = "blue", 
     pch = 16, 
     main = "Scatter Plot of Incongruency Effect",
     xlab = "Incongruency Effect (ms)",
     ylab = "Condition")

# Adding Biased Attender Data Points
points(biased_data$Incongruency_Effect_Data, 
       col = "red", 
       pch = 16)
```

